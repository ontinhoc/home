<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Encryptor (Plain/HTML)</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 24px; }
    .row { display: grid; grid-template-columns: 1fr; gap: 12px; max-width: 960px; }
    textarea { width: 100%; min-height: 280px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 13px; padding: 10px; }
    input[type=password] { width: 100%; padding: 10px; font-size: 14px; }
    button { padding: 10px 16px; background:#0369a1; color:#fff; border:0; border-radius:6px; cursor:pointer; }
    .muted { color:#475569; font-size: 13px; }
    .out { min-height: 120px; }
    .grid2 { display:grid; grid-template-columns: 1fr auto; gap:8px; align-items:center; }
  </style>
  <meta name="robots" content="noindex, noarchive">
</head>
<body>
  <h1>Mã hóa nội dung Plain/HTML</h1>
  <p class="muted">Dán nội dung HTML (hoặc văn bản) vào ô dưới đây, nhập mật khẩu rồi bấm Mã hóa. Kết quả (base64) dán vào hằng <code>ENCRYPTED_HTML</code> trong trang bảo vệ (ví dụ: <code>tin-12-bai-3-ly-thuyet-protected.html</code>).</p>

  <div class="row">
    <label>Nội dung (HTML hoặc văn bản thuần)</label>
    <textarea id="plain" placeholder="&lt;h1&gt;Tiêu đề&lt;/h1&gt;\n&lt;p&gt;Đoạn văn...&lt;/p&gt;"></textarea>

    <div class="grid2">
      <input id="pw" type="password" placeholder="Mật khẩu" />
      <button id="encBtn">Mã hóa</button>
    </div>

    <label>Kết quả (base64)</label>
    <textarea id="out" class="out" readonly></textarea>
    <div>
      <button id="copyBtn" style="background:#0d9488">Sao chép</button>
      <span id="msg" class="muted"></span>
    </div>
  </div>

  <script>
    function bytesToB64(bytes){
      let bin=''; for(let i=0;i<bytes.length;i++) bin+=String.fromCharCode(bytes[i]);
      return btoa(bin);
    }
    function randomBytes(n){ const a=new Uint8Array(n); crypto.getRandomValues(a); return a; }
    async function deriveKey(password, salt){
      const enc = new TextEncoder();
      const keyMaterial = await crypto.subtle.importKey('raw', enc.encode(password), 'PBKDF2', false, ['deriveKey']);
      return crypto.subtle.deriveKey({name:'PBKDF2', salt, iterations:200000, hash:'SHA-256'}, keyMaterial, {name:'AES-GCM', length:256}, false, ['encrypt']);
    }
    async function encrypt(password, text){
      const salt = randomBytes(16), iv = randomBytes(12);
      const key = await deriveKey(password, salt);
      const ct = await crypto.subtle.encrypt({name:'AES-GCM', iv}, key, new TextEncoder().encode(text));
      const ctBytes = new Uint8Array(ct);
      const out = new Uint8Array(1 + salt.length + iv.length + ctBytes.length);
      let p=0; out[p++]=1; out.set(salt,p); p+=16; out.set(iv,p); p+=12; out.set(ctBytes,p);
      return bytesToB64(out);
    }
    const plain = document.getElementById('plain');
    const pw = document.getElementById('pw');
    const out = document.getElementById('out');
    const msg = document.getElementById('msg');
    document.getElementById('encBtn').addEventListener('click', async()=>{
      msg.textContent='';
      try{
        const b64 = await encrypt(pw.value || '', plain.value || '');
        out.value = b64; msg.textContent='Đã mã hóa xong.';
      }catch(e){ msg.textContent='Lỗi: ' + (e && e.message ? e.message : e); }
    });
    document.getElementById('copyBtn').addEventListener('click', async()=>{
      try{ await navigator.clipboard.writeText(out.value); msg.textContent='Đã sao chép.'; }catch{}
    });
  </script>
</body>
</html>

